(ns morgan.server
  (:require [noir.server :as server])
  (:use [somnium.congomongo]
        [morgan.db :only conn]))

(server/load-views "src/morgan/views/")

(defn -main [& m]
  (let [mode (keyword (or (first m) :dev))
        port (Integer. (get (System/getenv) "OPENSHIFT_INTERNAL_PORT" "8080"))
	host (get (System/getenv) "OPENSHIFT_INTERNAL_IP")]
    ;(set-connection! conn)
    ;(authenticate conn "admin" "grwZRUTcdpB3")
    (server/start port {:mode mode
                        :ns 'morgan
                        :jetty-options {:host host}})))
